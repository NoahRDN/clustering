services:
  # ---------------------------
  # ðŸ”¹ HAProxy (load balancer)
  # ---------------------------
  haproxy:
    image: haproxy:2.9
    container_name: haproxy
    ports:
      - "8080:8080"     # Port public du site
      - "8404:8404"     # Statistiques
    volumes:
      - ./haproxy/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
    depends_on:
      - web1
      - web2
      - mysql
    networks:
      - public_net
      - private_net

  # ---------------------------
  # ðŸ”¹ Serveur Web 1 (Apache + PHP)
  # ---------------------------
  web1:
    image: php:8.2-apache
    container_name: web1
    volumes:
      - ./web/web1:/var/www/html
    depends_on:
      - mysql
    networks:
      - private_net
    command: >
      bash -c "docker-php-ext-install pdo pdo_mysql && apache2-foreground"

  # ---------------------------
  # ðŸ”¹ Serveur Web 2 (Apache + PHP)
  # ---------------------------
  web2:
    image: php:8.2-apache
    container_name: web2
    volumes:
      - ./web/web2:/var/www/html
    depends_on:
      - mysql
    networks:
      - private_net
    command: >
      bash -c "docker-php-ext-install pdo pdo_mysql && apache2-foreground"
  # ---------------------------
  # ðŸ”¹ Base de donnÃ©es MySQL
  # ---------------------------
  mysql:
    image: mysql:8.0
    container_name: mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: sessions_test
    volumes:
      - ./mysql/init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - private_net

# ---------------------------
# ðŸ”¹ RÃ©seaux
# ---------------------------
networks:
  public_net:
  private_net:
