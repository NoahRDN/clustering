# ======================================================
# ðŸ”¹ Configuration HAProxy pour 2 serveurs Apache locaux
# ======================================================

global
    log stdout format raw local0   # Affiche les logs dans "docker logs"
    daemon                         # ExÃ©cute HAProxy en mode service

defaults
    mode http                      # Mode HTTP (on gÃ¨re du web)
    option httplog                 # Active les logs HTTP
    timeout connect 5000           # DÃ©lai max de connexion Ã  un serveur
    timeout client  50000          # DÃ©lai max de rÃ©ponse client
    timeout server  50000          # DÃ©lai max de rÃ©ponse serveur

# ---------------------------
# ðŸ”¹ FRONTEND : point d'entrÃ©e utilisateur
# ---------------------------
frontend http_front
    bind *:8080                    # HAProxy Ã©coute sur le port 8080
    default_backend web_back       # Redirige vers le backend

# ---------------------------
# ðŸ”¹ BACKEND : serveurs web
# ---------------------------
backend web_back
    balance roundrobin             # RÃ©partition Ã©quitable (1, 2, 1, 2, ...)
    option httpchk                 # VÃ©rifie que le serveur rÃ©pond
    server web1 web1:80 check      # Serveur Apache 1
    server web2 web2:80 check      # Serveur Apache 2

# ---------------------------
# ðŸ”¹ STATISTIQUES
# ---------------------------
listen stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 10s
