# ======================================================
# ðŸ”¹ HAProxy avec persistance de session (sticky session)
# ======================================================

global
    log stdout format raw local0

defaults
    mode http
    option httplog
    option http-server-close
    timeout connect 5000
    timeout client  50000
    timeout server  50000

# ---------------------------
# ðŸ”¹ FRONTEND (entrÃ©e)
# ---------------------------
frontend http_front
    bind *:8080
    default_backend web_back

# ---------------------------
# ðŸ”¹ BACKEND (serveurs web)
# ---------------------------
backend web_back
    balance roundrobin                  # rÃ©partition de base
    cookie SRV insert indirect nocache  # <--- cookie SRV ajoutÃ© par HAProxy
    option httpchk                      # vÃ©rifie que le serveur rÃ©pond

    server web1 web1:80 cookie S1 check # identifiant du serveur web1
    server web2 web2:80 cookie S2 check # identifiant du serveur web2

# ---------------------------
# ðŸ”¹ STATISTIQUES
# ---------------------------
listen stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 10s
